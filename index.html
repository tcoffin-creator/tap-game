<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Road Rules Junior</title>
  <style>
    body {margin:0; background:#d0eaf9;}
    #scoreboard {position:fixed; left:20px; top:20px; z-index:10;
      font:1.2em Arial, sans-serif; color:#1856e9;}
    #message {position:fixed; top:60px; left:50%; transform:translateX(-50%);
      font:1.6em Arial, sans-serif; color:#222; background:#fff4; border-radius:8px; padding:8px 18px; min-width:200px; text-align:center;}
    #restartBtn {
      position:fixed; bottom:30px; left:50%; transform:translateX(-50%);
      z-index:11; padding:12px 34px; font-size:1.1em; background:#58cd4d;
      color:#fff; border:none; border-radius:9px; box-shadow:0 2px 16px #135b;
      cursor:pointer; display:none;
    }
    #gameCanvas {
      display:block; margin:48px auto 0; background: #eaf2ff;
      border-radius:16px; box-shadow: 0 0 40px #1856e944;
    }
  </style>
</head>
<body>
  <div id="scoreboard">
    <span>Score: <span id="score">0</span></span>
    &nbsp; | &nbsp;
    <span>Level: <span id="level">1</span></span>
  </div>
  <div id="message"></div>
  <button id="restartBtn">Restart</button>
  <canvas id="gameCanvas" width="780" height="360"></canvas>
<script>
const W = 780, H = 360;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const messageEl = document.getElementById('message');
const restartBtn = document.getElementById('restartBtn');

// --- Game State ---
let carX, carY, carSpeed, carBlinker, score, level, run, waiting, stopType, wrongAction, timer, blinkerUsed;
let roadItems = [];

// -- Helper: Draw Car (simple cartoon) --
function drawCar(x, y, blinker) {
  ctx.save();
  // body
  ctx.fillStyle = "#2584de";
  ctx.fillRect(x-58, y-18, 72, 36);
  // roof
  ctx.fillStyle = "#1856e9";
  ctx.fillRect(x-36, y-32, 42, 20);
  // Wheels
  ctx.beginPath(); ctx.arc(x-32, y+16, 9, 0, 2*Math.PI); ctx.arc(x+20, y+16, 9, 0, 2*Math.PI);
  ctx.fillStyle = "#222"; ctx.fill();
  // Windshield
  ctx.fillStyle = "#eaf7fc"; ctx.fillRect(x-32, y-20, 40, 7);
  // Headlights
  ctx.beginPath(); ctx.arc(x+15, y-9, 6, 0, 2*Math.PI); ctx.arc(x+15, y+9, 6, 0, 2*Math.PI);
  ctx.fillStyle="#ffd800"; ctx.fill();
  // Blinkers
  if (blinker=="right") {
    ctx.beginPath(); ctx.arc(x+33, y-9, 4, 0, 2*Math.PI); ctx.arc(x+33, y+9, 4, 0, 2*Math.PI);
    ctx.fillStyle="#ffb300"; ctx.fill();
  }
  if (blinker=="left") {
    ctx.beginPath(); ctx.arc(x-62, y-9, 4, 0, 2*Math.PI); ctx.arc(x-62, y+9, 4, 0, 2*Math.PI);
    ctx.fillStyle="#ffb300"; ctx.fill();
  }
  ctx.restore();
}

// -- Helper: Draw Stop Light --
function drawTrafficLight(x, y, color) {
  ctx.save();
  ctx.fillStyle="#444"; ctx.fillRect(x-12,y-24,28,60);
  ctx.beginPath();
  ctx.arc(x+2, y-12, 8, 0, 2*Math.PI); ctx.fillStyle=color==="red"?"#db2323":"#960a0a"; ctx.fill();
  ctx.arc(x+2, y+6, 8, 0, 2*Math.PI); ctx.fillStyle=color==="yellow"?"#ffd600":"#968300"; ctx.fill();
  ctx.arc(x+2, y+24, 8, 0, 2*Math.PI); ctx.fillStyle=color==="green"?"#36c034":"#235d1c"; ctx.fill();
  ctx.restore();
}

// --- Setup Level ---
function setupLevel(lvl) {
  carX=70; carY=H/2; carSpeed=0; carBlinker=null; score=score||0; run=true; waiting=false; stopType=null; wrongAction=""; timer=0; blinkerUsed=false;
  roadItems = [
    { type:"light", x:290, y:H/2-50, color: ["red","green","yellow"][Math.floor(Math.random()*3)] },
    { type:"stopSign", x:510, y:H/2-50 }
  ];
  messageEl.textContent = "Drive! Arrow keys to move, <- or -> for blinkers before turns.";
  level=lvl; levelEl.textContent=level;
}

// -- Game Loop --
function gameLoop() {
  ctx.clearRect(0,0,W,H);
  // Road
  ctx.save();
  ctx.fillStyle="#5c6f76";
  ctx.fillRect(0, H/2-44, W, 94);
  for (let i=0;i<12;i++){
    ctx.fillStyle="#fff";
    ctx.fillRect(i*64+20, H/2-2, 38, 8);
  }
  ctx.restore();
  // Crosswalks and intersections
  ctx.save();
  ctx.fillStyle="#eee";
  ctx.fillRect(280, H/2-44, 12, 94);
  ctx.fillRect(500, H/2-44, 12, 94);
  ctx.restore();

  // Roadside items
  for (let itm of roadItems) {
    if (itm.type=="light") drawTrafficLight(itm.x, itm.y, itm.color);
    if (itm.type=="stopSign") {
      ctx.save();
      ctx.beginPath(); ctx.arc(itm.x, itm.y+44, 20, 0, 2*Math.PI); ctx.fillStyle="#de2222"; ctx.fill();
      ctx.fillStyle="#fff"; ctx.font="bold 16px Arial"; ctx.textAlign="center";
      ctx.fillText("STOP", itm.x, itm.y+50);
      ctx.restore();
    }
  }

  // Car
  drawCar(carX, carY, carBlinker);

  // Movement & rules
  if (run) {
    if (waiting) {
      timer++;
      if (timer>60 && stopType=="light" && wrongAction=="") {
        if (roadItems[0].color=="green") {
          messageEl.textContent="Great! You drove on green.";
          score++; scoreEl.textContent=score;
          waiting=false;
        } else {
          messageEl.textContent="Oops! Wait for green.";
          run=false;
          restartBtn.style.display="block";
        }
      }
      if (timer>60 && stopType=="stopSign" && wrongAction=="") {
        messageEl.textContent="Nice stop at the sign!";
        score++; scoreEl.textContent=score;
        waiting=false;
      }
    } else {
      carSpeed = Math.min(carSpeed+0.15, 4);
      carX += carSpeed;
      // Traffic light stop
      if (carX>roadItems[0].x-32 && carX<roadItems[0].x+32 && !waiting) {
        stopType="light";
        if (roadItems[0].color!="green") {
          if (carSpeed>2) {
            messageEl.textContent="Hit the brakes! Stop for red/yellow.";
            run=false; restartBtn.style.display="block";
            wrongAction="ranLight";
          } else {
            messageEl.textContent="Good! Waiting for green...";
            waiting=true; timer=0;
            carSpeed=0;
          }
        }
      }
      // Stop sign
      if (carX>roadItems[1].x-26 && carX<roadItems[1].x+20 && !waiting) {
        stopType="stopSign";
        if (carSpeed>1.6) {
          messageEl.textContent="Hit the brakes! Stop at the sign.";
          run=false; restartBtn.style.display="block";
          wrongAction="missedStop";
        } else {
          messageEl.textContent="Good! Waiting a moment...";
          waiting=true; timer=0;
          carSpeed=0;
        }
      }
    }
    // End of road
    if (carX>W-90) {
      messageEl.textContent="Level Complete!";
      score++; scoreEl.textContent=score;
      run=false;
      restartBtn.style.display="block";
    }
  }

  // Simple blinker check for turns (Arrow keys set status)
  window.onkeydown = function(e){
    if(e.key==="ArrowRight") carBlinker="right", blinkerUsed=true;
    if(e.key==="ArrowLeft") carBlinker="left", blinkerUsed=true;
    if(e.key==="ArrowUp"||e.key==="ArrowDown") carBlinker=null;
  };

  if(run) requestAnimationFrame(gameLoop);
}

// -- Restart/Next Level --
function resetGame() {
  setupLevel((level||1)+1);
  scoreEl.textContent=score;
  restartBtn.style.display="none";
  gameLoop();
}
restartBtn.onclick = resetGame;

// -- Start!
setupLevel(1);
gameLoop();
</script>
</body>
</html>
